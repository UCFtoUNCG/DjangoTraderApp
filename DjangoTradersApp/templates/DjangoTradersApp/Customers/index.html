{% extends "base.html" %}

{% block content %}

<div class="container shadow-sm">

	<!-- Search Form -->
	<form method="GET" class="d-flex">
		<div class="navbar">

			<!-- Search Inputs -->
			<div class="nav">

				<!-- Search By Customer-->
				<div class="nav-item me-1">
					<input type="text"
							   name="customer"
							   class="form-control me-2"
							   placeholder="Search by customer..."
							   value="{{ search_customer }}">
				</div>

				<!-- Search By Country-->
				<div class="nav-item me-1">
					<select name="country" class="form-select me-2">
						<option value="">Select country...</option>
						{% for country in available_countries %}
							{% if country %}
								<option value="{{ country }}" {% if country == search_country %}selected{% endif %}>
									{{ country }}
								</option>
							{% endif %}
						{% endfor %}
					</select>
				</div>
			</div>

			<!--Search by Title-->
			<div class="nav-item me-1">
				<input type="text"
					   name="title"
					   class="form-control me-2"
					   placeholder="Search by title..."
					   value="{{ search_title }}">
			</div>

			<!-- Search and Clear Buttons-->
			<div class="nav ms-2">
				<button type="submit" class="btn btn-light ">
					<i class="fa fa-search"></i>
				</button>
				<a href="{% url 'DjTraders.Customers' %}"
					class="btn btn-light ms-2">
					<i class="fa fa-times"></i>
				
				</a>
			</div>

		</div>
	</form>


	{% if customers %}
	
	<table class="table table-hover"
		   id="CustomersTable" width="100%">
		<thead>
			<tr class="">
				<th></th>	
				<th class="my-2 text-center" style=""> Customer </th>
				<th class="ps-1" style=""> Contact</th>
				<th class="" style=""> Title </th>	
				<th class="text-center" style="">Address</th>
				<th class="" style="">City</th>
				<th class="px-2" style="">Country</th>
				<th> Details</th>
			</tr>
		</thead>

		<nav aria-label="Customer pages">
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_customer %}&customer={{ search_customer }}{% endif %}{% if search_title %}&title={{ search_title }}{% endif %}{% if search_country %}&country={{ search_country }}{% endif %}" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
    {% endif %}

    {% for num in paginator.page_range %}
      {% if page_obj.number == num %}
        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
      {% else %}
        <li class="page-item">
          <a class="page-link" href="?page={{ num }}{% if search_customer %}&customer={{ search_customer }}{% endif %}{% if search_title %}&title={{ search_title }}{% endif %}{% if search_country %}&country={{ search_country }}{% endif %}">{{ num }}</a>
        </li>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_customer %}&customer={{ search_customer }}{% endif %}{% if search_title %}&title={{ search_title }}{% endif %}{% if search_country %}&country={{ search_country }}{% endif %}" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
    {% endif %}
  </ul>
</nav>

		<tbody class="small">

			{% for customer in customers %}
			<tr >
				<td>{{forloop.counter}}</td>
				<td class="p-2">{{customer.company_name}}</td>
				<td class="p-2">{{customer.contact_name}}</td>
				<td class="p-2">{{customer.contact_title}}</td>
				<td class="p-2">{{customer.address}}</td>
				<td class="p-2">{{customer.city}}</td>
				<td class="p-2">{{customer.country}}</td>

				<td title="Click to see details" class="text-center">
					<a 	href = {% url 'DjTraders.CustomerDetail' customer_id=customer.customer_id %} class="">
						<i class="fa-solid fa-house-user fa-lg pt-2" style="color: steelblue;"></i>
					</a>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>	
	{% else %}
		<div class="alert alert-warning">
			{% if search_country %}
				No customers found for country "{{ search_country }}". 
				<a href="{% url 'DjTraders.Customers' %}">Show all customers</a>
			{% else %}
				No Customers Found
			{% endif %}
		</div>
	{% endif %}
</div>

<script type="text/javascript">
$(document).ready(function() {
  $('#CustomersTable').DataTable({
    paging: true,         // Enable pagination
	pagingType: 'simple_numbers', // Simple pagination controls
    searching: true,      // Enable search box
    ordering: true,       // Enable column sorting
    pageLength: 10,       // Show 10 rows per page
    lengthMenu: [10, 25, 50], // Page length options
    info: true,           // Show table info
    // Add more options as needed
  });
});
</script>

{% endblock %}
